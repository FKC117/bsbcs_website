
{% extends "pages/base.html" %}
{% load static %}

{% block content %}
    <!-- Page Header -->
    <section class="bg-gradient-to-br from-primary-50 via-secondary-50 to-accent-50 py-12 md:py-16 relative overflow-hidden">
        <div class="absolute inset-0 opacity-10">
            <svg class="w-full h-full" viewBox="0 0 1200 400" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="200" cy="100" r="120" fill="#E91E63"/>
                <circle cx="1000" cy="300" r="150" fill="#1976D2"/>
                <circle cx="600" cy="200" r="100" fill="#00695C"/>
            </svg>
        </div>
        
        <div class="container-custom relative z-10">
            <div class="max-w-3xl">
                <div class="inline-flex items-center gap-2 bg-primary-100 text-primary-800 px-4 py-2 rounded-full mb-4">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
                    </svg>
                    <span class="font-semibold">2,500+ Active Members</span>
                </div>
                {% if hero and hero.title %}
                    <h1 class="text-4xl md:text-5xl font-headline font-bold text-text-primary mb-4">{{ hero.title }}</h1>
                {% else %}
                    <h1 class="text-4xl md:text-5xl font-headline font-bold text-text-primary mb-4">Member Directory</h1>
                {% endif %}
                {% if hero and hero.subtitle %}
                    <p class="text-lg text-text-secondary leading-relaxed mb-8">{{ hero.subtitle }}</p>
                {% else %}
                    <p class="text-lg text-text-secondary leading-relaxed mb-8">Connect with Bangladesh's leading breast cancer specialists, researchers, and healthcare professionals. Build collaborations, share knowledge, and advance patient care together.</p>
                {% endif %}
                {% if call_to_action %}
                    <div class="mb-8 flex flex-wrap gap-4">
                        {% if call_to_action.primary_button_text and call_to_action.primary_button_url %}
                            <a href="{{ call_to_action.primary_button_url }}" class="btn-primary inline-block">{{ call_to_action.primary_button_text }}</a>
                        {% endif %}
                        {% if call_to_action.secondary_button_text and call_to_action.secondary_button_url %}
                            <a href="{{ call_to_action.secondary_button_url }}" class="btn-outline inline-block">{{ call_to_action.secondary_button_text }}</a>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        </div>
    </section>

    <!-- Search and Filter Section -->
    <section class="section-compact bg-surface border-b border-border sticky top-20 z-sticky">
        <div class="container-custom">
            <div class="flex flex-col lg:flex-row gap-4">
                <!-- Search Bar -->
                <div class="flex-1">
                    <div class="relative">
                        <svg class="absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-text-tertiary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                        <input type="text" id="searchInput" placeholder="Search by name, specialty, institution..." class="form-input pl-12 pr-4">
                    </div>
                </div>

                <!-- Filter Button -->
                <button id="filterToggle" class="btn-outline flex items-center gap-2 whitespace-nowrap">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
                    </svg>
                    Advanced Filters
                    <span id="filterCount" class="hidden bg-primary text-white text-xs px-2 py-1 rounded-full">0</span>
                </button>

                <!-- Reset Filters -->
                <button id="resetFilters" class="btn-ghost hidden">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                </button>
            </div>

            <!-- Advanced Filter Panel -->
            <div id="filterPanel" class="hidden mt-6 p-6 bg-primary-50 rounded-lg border border-primary-200">
                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <!-- Specialty Filter -->
                    <div>
                        <label class="form-label">Specialty</label>
                        <select id="specialtyFilter" class="form-input">
                            <option value="">All Specialties</option>
                            <option value="medical-oncology">Medical Oncology</option>
                            <option value="surgical-oncology">Surgical Oncology</option>
                            <option value="radiation-oncology">Radiation Oncology</option>
                            <option value="radiology">Radiology</option>
                            <option value="pathology">Pathology</option>
                            <option value="genetics">Genetics & Genomics</option>
                            <option value="nursing">Oncology Nursing</option>
                            <option value="research">Research</option>
                        </select>
                    </div>

                    <!-- Location Filter -->
                    <div>
                        <label class="form-label">Location</label>
                        <select id="locationFilter" class="form-input">
                            <option value="">All Locations</option>
                            <option value="dhaka">Dhaka</option>
                            <option value="chittagong">Chittagong</option>
                            <option value="sylhet">Sylhet</option>
                            <option value="rajshahi">Rajshahi</option>
                            <option value="khulna">Khulna</option>
                            <option value="barisal">Barisal</option>
                            <option value="rangpur">Rangpur</option>
                        </select>
                    </div>

                    <!-- Experience Filter -->
                    <div>
                        <label class="form-label">Years of Experience</label>
                        <select id="experienceFilter" class="form-input">
                            <option value="">Any Experience</option>
                            <option value="0-5">0-5 years</option>
                            <option value="5-10">5-10 years</option>
                            <option value="10-15">10-15 years</option>
                            <option value="15-20">15-20 years</option>
                            <option value="20+">20+ years</option>
                        </select>
                    </div>

                    <!-- Research Interest Filter -->
                    <div>
                        <label class="form-label">Research Interest</label>
                        <select id="researchFilter" class="form-input">
                            <option value="">All Research Areas</option>
                            <option value="immunotherapy">Immunotherapy</option>
                            <option value="targeted-therapy">Targeted Therapy</option>
                            <option value="early-detection">Early Detection</option>
                            <option value="genetics">Genetic Research</option>
                            <option value="clinical-trials">Clinical Trials</option>
                            <option value="survivorship">Survivorship Care</option>
                        </select>
                    </div>
                </div>

                <div class="flex justify-end gap-4 mt-6">
                    <button id="clearFilters" class="btn-ghost">Clear All</button>
                    <button id="applyFilters" class="btn-primary">Apply Filters</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Results Summary -->
    <section class="section-compact bg-background">
        <div class="container-custom">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                <p class="text-text-secondary">
                    Showing <span id="resultCount" class="font-semibold text-text-primary">2,487</span> members
                </p>
                <div class="flex items-center gap-4">
                    <label class="text-sm text-text-secondary">Sort by:</label>
                    <select id="sortBy" class="form-input py-2">
                        <option value="name">Name (A-Z)</option>
                        <option value="specialty">Specialty</option>
                        <option value="experience">Experience</option>
                        <option value="recent">Recently Joined</option>
                    </select>
                </div>
            </div>
        </div>
    </section>

    <!-- Member Grid -->
    <section class="section">
        <div class="container-custom">
            <div id="memberGrid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                {% for member in members %}
                <div class="card hover-lift hover-shadow member-card" data-specialty="{{ member.specialty|default:'' }}" data-location="{{ member.location|default:'' }}" data-experience="{{ member.years_of_experience|default:'' }}">
                    <div class="flex items-start gap-4 mb-4">
                        {% if member.image %}
                            <img src="{{ member.image.url }}" alt="{{ member.name }}{% if member.specialty %}, {{ member.specialty }}{% endif %}{% if member.years_of_experience %} with {{ member.years_of_experience }} years experience{% endif %}" class="w-20 h-20 rounded-full object-cover border-2 border-primary-200" loading="lazy">
                        {% else %}
                            <img src="{% static 'img/default-avatar.png' %}" alt="{{ member.name }}" class="w-20 h-20 rounded-full object-cover border-2 border-primary-200" loading="lazy">
                        {% endif %}
                        <div class="flex-1">
                            <h3 class="text-xl font-headline font-semibold text-text-primary mb-1">{{ member.name }}</h3>
                            {% if member.specialty %}
                                <p class="text-sm text-secondary font-semibold mb-2">{{ member.specialty }}</p>
                            {% endif %}
                            <div class="flex items-center gap-2 text-xs text-text-secondary">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                                </svg>
                                {% if member.years_of_experience %}<span>{{ member.years_of_experience }} years experience</span>{% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <p class="text-sm text-text-secondary mb-4 leading-relaxed">{{ member.profile_description }}</p>
                    
                    <div class="flex flex-wrap gap-2 mb-4">
                        {% if member.location %}
                        <span class="inline-flex items-center gap-1 bg-accent-50 text-accent-800 px-3 py-1 rounded-full text-xs font-semibold">
                            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
                            </svg>
                            {{ member.location }}
                        </span>
                        {% endif %}
                        {% if member.research_interest %}
                        <span class="inline-flex items-center gap-1 bg-primary-50 text-primary-800 px-3 py-1 rounded-full text-xs font-semibold">
                            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3z"/>
                            </svg>
                            {{ member.research_interest|truncatewords:6 }}
                        </span>
                        {% endif %}
                        {% for tag in member.tags.all %}
                            <span class="inline-flex items-center gap-1 bg-primary-50 text-primary-800 px-3 py-1 rounded-full text-xs font-semibold">{{ tag.name }}</span>
                        {% endfor %}
                    </div>

                    <div class="border-t border-border pt-4 flex items-center justify-between">
                        <div class="text-xs text-text-secondary">
                            {% if member.institution %}<p class="font-semibold text-text-primary">{{ member.institution }}</p>{% endif %}
                            {% if member.position %}<p>{{ member.position }}</p>{% endif %}
                        </div>
                        {% if member.profile_url %}
                            <a href="{{ member.profile_url }}" class="btn-ghost text-sm py-2 px-4">View Profile</a>
                        {% else %}
                            <button class="btn-ghost text-sm py-2 px-4">View Profile</button>
                        {% endif %}
                    </div>
                </div>
                {% empty %}
                <p class="text-center text-text-secondary">No members have been added yet.</p>
                {% endfor %}
            </div>

            <!-- Load More Button -->
            <div class="text-center mt-12">
                <button class="btn-outline">
                    Load More Members
                    <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
            </div>
        </div>
    </section>

    <!-- Membership Benefits CTA -->
    <section class="section bg-gradient-to-br from-secondary via-secondary-600 to-secondary-700 text-white relative overflow-hidden">
        <div class="absolute inset-0 opacity-10">
            <svg class="w-full h-full" viewBox="0 0 1200 400" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="100" cy="100" r="100" fill="white"/>
                <circle cx="1100" cy="300" r="150" fill="white"/>
                <circle cx="600" cy="200" r="80" fill="white"/>
            </svg>
        </div>
        
        <div class="container-custom relative z-10">
            <div class="max-w-3xl mx-auto text-center">
                <h2 class="text-3xl md:text-4xl font-headline font-bold mb-6">Join Our Professional Network</h2>
                <p class="text-lg text-secondary-100 mb-8 leading-relaxed">Connect with 2,500+ breast cancer specialists, access exclusive research, participate in collaborative studies, and advance your professional development.</p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <button class="btn bg-white text-secondary hover:bg-secondary-50 focus:ring-white">Apply for Membership</button>
                    <button class="btn bg-transparent border-2 border-white text-white hover:bg-white/10 focus:ring-white">Learn About Benefits</button>
                </div>
            </div>
        </div>
    </section>
{% endblock %}

{% block extra_js %}
    <script>
        // Filter Panel Toggle
        const filterToggle = document.getElementById('filterToggle');
        const filterPanel = document.getElementById('filterPanel');
        const resetFilters = document.getElementById('resetFilters');
        const clearFilters = document.getElementById('clearFilters');
        const applyFilters = document.getElementById('applyFilters');
        const filterCount = document.getElementById('filterCount');

        filterToggle.addEventListener('click', () => {
            filterPanel.classList.toggle('hidden');
        });

        // Search Functionality
        const searchInput = document.getElementById('searchInput');
        const memberCards = document.querySelectorAll('.member-card');
        const resultCount = document.getElementById('resultCount');

        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            let visibleCount = 0;

            memberCards.forEach(card => {
                const text = card.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    card.style.display = 'block';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });

            resultCount.textContent = visibleCount;
        });

        // Filter Functionality
        const specialtyFilter = document.getElementById('specialtyFilter');
        const locationFilter = document.getElementById('locationFilter');
        const experienceFilter = document.getElementById('experienceFilter');
        const researchFilter = document.getElementById('researchFilter');

        function updateFilterCount() {
            let count = 0;
            if (specialtyFilter.value) count++;
            if (locationFilter.value) count++;
            if (experienceFilter.value) count++;
            if (researchFilter.value) count++;

            if (count > 0) {
                filterCount.textContent = count;
                filterCount.classList.remove('hidden');
                resetFilters.classList.remove('hidden');
            } else {
                filterCount.classList.add('hidden');
                resetFilters.classList.add('hidden');
            }
        }

        function applyFilterLogic() {
            let visibleCount = 0;

            memberCards.forEach(card => {
                const specialty = card.dataset.specialty;
                const location = card.dataset.location;
                const experience = card.dataset.experience;

                const specialtyMatch = !specialtyFilter.value || specialty === specialtyFilter.value;
                const locationMatch = !locationFilter.value || location === locationFilter.value;
                const experienceMatch = !experienceFilter.value || experience === experienceFilter.value;

                if (specialtyMatch && locationMatch && experienceMatch) {
                    card.style.display = 'block';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });

            resultCount.textContent = visibleCount;
            updateFilterCount();
        }

        applyFilters.addEventListener('click', () => {
            applyFilterLogic();
            filterPanel.classList.add('hidden');
        });

        clearFilters.addEventListener('click', () => {
            specialtyFilter.value = '';
            locationFilter.value = '';
            experienceFilter.value = '';
            researchFilter.value = '';
            updateFilterCount();
        });

        resetFilters.addEventListener('click', () => {
            specialtyFilter.value = '';
            locationFilter.value = '';
            experienceFilter.value = '';
            researchFilter.value = '';
            searchInput.value = '';
            memberCards.forEach(card => card.style.display = 'block');
            resultCount.textContent = memberCards.length;
            updateFilterCount();
        });

        // Sort Functionality
        const sortBy = document.getElementById('sortBy');
        const memberGrid = document.getElementById('memberGrid');

        sortBy.addEventListener('change', (e) => {
            const sortValue = e.target.value;
            const cardsArray = Array.from(memberCards);

            cardsArray.sort((a, b) => {
                if (sortValue === 'name') {
                    const nameA = a.querySelector('h3').textContent;
                    const nameB = b.querySelector('h3').textContent;
                    return nameA.localeCompare(nameB);
                } else if (sortValue === 'specialty') {
                    const specA = a.dataset.specialty;
                    const specB = b.dataset.specialty;
                    return specA.localeCompare(specB);
                } else if (sortValue === 'experience') {
                    const expA = a.dataset.experience;
                    const expB = b.dataset.experience;
                    return expB.localeCompare(expA);
                }
                return 0;
            });

            memberGrid.innerHTML = '';
            cardsArray.forEach(card => memberGrid.appendChild(card));
        });
    </script>
{% endblock %}
